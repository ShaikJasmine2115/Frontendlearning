<html>
    <head>
        <title>Product Management System</title>
    </head>
    <body>
        <h1>Chocolate manufacturers</h1>
        <button id="view">View all products</button> <br> 
       <!-- <table id="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>ITEM</th>
                <th>PRICE</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>-->     
       
        <span id="dx"></span>
       <ul id="display"></ul>
          <!--<ul>
             <b>Available products</b><hr>
            <li id="p1">a</li>
            <li id="p2">b</li>
            <li id="p3">c</li>
        </ul>
      
         existing products -->
        <!--<table>
            <tr>
                <th>Item</td>
                <th>Price</td>
            </tr>
            <tr>
                <td>a</td>
                <td>$5</td>
            </tr>
            <tr>
                <td>b</td>
                <td>$4</td>
            </tr>
            <tr>
                <td>c</td>
                <td>$7</td>
            </tr>
        </table>--> <hr>
        <h2>Add new product</h2>

        <label for ="pid">Product ID</label> 
        <input id="pid" type="text" required>
          
        <label for ="pname">Product name</label> 
        <input id="pname" type="text" required>

        <label for ="pprice">Product price</label> 
        <input id="pprice" type="text"><BR> <br>

        <button id="addbtn">Add product</button> <br>
        <span id="span"></span>
        <hr>
        <h2>Update the product</h2>
        <b>Update price of -ID </b>
        <input id="updateid" type="text" placeholder="Enter item ID"> 
        <b>Update price of </b>
        <input id="updatename" type="text" placeholder="Enter item name"> 
        <b>Update price to</b>
        <input id="updateprice" type="number" placeholder="Enter price "> <br> <br>
        <button id="updatebtn">Update product's price</button> <br> 
        <span id="span2"></span>

        <hr>
        <h2>Discounted products</h2>
        <i>Percentage</i>
      
       <input id="getdiscount"; type="text"> <br> <br>
       <button id="discountbtn" type="submit">Apply</button>
       <span id="span3"></span>
       <ul id="ul2"></ul>
     

    </body>
    <script>
        window.onload = function() {
            // Check if the user is logged in
            if (!sessionStorage.getItem("loggedIn")) {
                document.getElementById("loginError").innerText = "You must be logged in to perform this action.";
                setTimeout(function() {
                    window.location.href = "login.html"; // Redirect if not logged in
                }, 3000);
            }
        };

        const products=[
    {id:1,Item:'Dairy milk', price:180},
    {id:2,Item:'5Star', price:30},
    {id:3,Item:'Snickers', price:120}
];
function viewall()
{
    return products;
}
function displayall(op)
{
    const display=document.getElementById("display");
    display.innerHTML="";
    const dx=document.getElementById("dx");
    dx.textContent="Available products are:"
    op.forEach(product=>{
        const listitem=document.createElement('li');
        listitem.textContent=`${product.id} - ${product.Item} - ${product.price}`;
        display.appendChild(listitem);
      })
}
function addproduct(prd)
{
    if(!products.find((j)=> (j.id==prd.pid && j.Item==prd.pname)))
    {
        let x={};
        x.id=prd.pid;
        x.Item=prd.pname;
        x.price=prd.pprice;
        products.push(x);
        return 1;
        console.log("added");
    }
    else{
        //console.log("Already exists");
        return 0;
    }
}
function displayadded(returned)
    {
        const dis=document.getElementById("span");
        if (returned==0)
        {
             dis.innerHTML="Product already exists";
        }
        else 
        {
            dis.innerHTML="Product added";
        }  
    }
function updateprice(prdupdate)
{
    const pdtoupdate=products.find(x => x.id==prdupdate.pid);
    if (pdtoupdate)
    {
        pdtoupdate.Item=prdupdate.pname;
        pdtoupdate.price=prdupdate.pprice;
        return true;
    }
    return false;
    
    displayall(viewall());
}
function displayupdated(returns)
{
    const dis=document.getElementById("span2");
        if (returns==0)
        {
             dis.innerHTML="New element- Go to 'add products'";
        }
        else 
        {
            dis.innerHTML="Product updated";
        }  
}
function applydiscount(disc)
{
    products.map(x=>(x.price= x.price-(x.price/100 * disc)))
    return products;
}
function displaydiscounted(products)
{
    const display=document.getElementById("ul2");
    display.innerHTML="";
    const dx=document.getElementById("span3");
    dx.textContent="Products after discount are:"
    products.forEach(product=>{
        const listitem=document.createElement('li');
        listitem.textContent=`${product.id} - ${product.Item} - ${product.price}`;
        display.appendChild(listitem);
      })
}


document.addEventListener("DOMContentLoaded", ()=> {
        const viewing=document.getElementById("view");
        viewing.addEventListener("click", ()=>{
        displayall(viewall());
        })    
            const adding= document.getElementById("addbtn");
            adding.addEventListener("click", ()=>{
                const pid=document.getElementById("pid").value;
                const pname=document.getElementById("pname").value;
                const pprice=document.getElementById("pprice").value;
                displayadded(addproduct({pid:pid,pname:pname,pprice:pprice}));    
         })
            const updating=document.getElementById("updatebtn");
            updating.addEventListener("click", ()=>{
                const updatepid=document.getElementById("updateid").value;
                const updatepdname=document.getElementById("updatename").value;
                const updatepdprice=document.getElementById("updateprice").value;
                displayupdated(updateprice({pid:updatepid,pname:updatepdname,pprice:updatepdprice}));
        })
            const discounting=document.getElementById("discountbtn");
            discounting.addEventListener("click", ()=>{
                const discpercent=document.getElementById("getdiscount");
                displaydiscounted(applydiscount(discpercent.value));

            })
        
    })

    </script>
</html>